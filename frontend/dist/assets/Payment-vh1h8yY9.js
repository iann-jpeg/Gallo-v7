import{j as e}from"./vendor-query-4MbTBVa_.js";import{u as a,e as s,r as t}from"./vendor-react-BPpqjFzU.js";import{H as r,C as l,a as i,J as n,b as c,d as m,L as d,I as o,a6 as h,a7 as x,a8 as u,a9 as p,B as N,M as j,X as y}from"./admin-D-5katVs.js";import{S as v,a5 as g,aG as b,k as f}from"./vendor-ui-DhEHJaaJ.js";const P=()=>{const P=a(),[w]=s(),[S,C]=t.useState(!1),[M,E]=t.useState({policyNumber:w.get("policy")||"",clientName:"",amount:w.get("amount")||"",paymentMethod:"mpesa",phoneNumber:"",cardNumber:"",expiryDate:"",cvv:"",email:"",billingPhone:""});return S?e.jsxs("div",{className:"min-h-screen",children:[e.jsx(r,{}),e.jsx("main",{className:"py-16",children:e.jsx("div",{className:"max-w-2xl mx-auto px-4 text-center",children:e.jsx(l,{children:e.jsxs(i,{className:"p-12",children:[e.jsx("div",{className:"animate-spin w-16 h-16 border-4 border-accent border-t-transparent rounded-full mx-auto mb-6"}),e.jsx("h2",{className:"text-2xl font-bold text-primary mb-4",children:"Processing your payment..."}),e.jsx("p",{className:"text-muted-foreground",children:"Please wait while we process your payment. Do not close this window."})]})})})}),e.jsx(n,{})]}):e.jsxs("div",{className:"min-h-screen",children:[e.jsx(r,{}),e.jsx("main",{className:"py-16 bg-secondary/30",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-primary mb-4",children:"Secure Payment Portal"}),e.jsxs("div",{className:"flex items-center justify-center space-x-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(v,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"Secure Payment"})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(g,{className:"h-4 w-4 text-green-600"}),e.jsx("span",{children:"SSL Protected"})]})]})]}),e.jsxs("div",{className:"grid lg:grid-cols-3 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(m,{className:"text-lg",children:"Policy Information"})}),e.jsxs(i,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Policy Number"}),e.jsx("p",{className:"text-lg font-mono",children:M.policyNumber||"POL-2024-001"})]}),e.jsxs("div",{children:[e.jsx(d,{className:"text-sm font-medium",children:"Amount Due"}),e.jsxs("p",{className:"text-2xl font-bold text-accent",children:["KES ",M.amount||"15,000"]})]}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"You are making a secure payment to Galloways Insurance Agency"})})]})]})}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(l,{children:[e.jsx(c,{children:e.jsx(m,{className:"text-xl",children:"Payment Details"})}),e.jsx(i,{children:e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),C(!0),!M.clientName||!M.amount||!M.email)return j({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"}),void C(!1);try{if("mpesa"===M.paymentMethod){if(!M.phoneNumber)return j({title:"Validation Error",description:"Please provide a valid phone number for M-PESA payment.",variant:"destructive"}),void C(!1);const e=await y.initiateSTKPush({phone:M.phoneNumber,amount:parseInt(M.amount),description:`Policy Payment - ${M.policyNumber||"Premium Payment"}`});if(!e.success)throw new Error(e.message||"Failed to initiate M-PESA payment");await y.createPayment({clientName:M.clientName,email:M.email,amount:M.amount,policyNumber:M.policyNumber,paymentMethod:M.paymentMethod,phone:M.phoneNumber,checkoutRequestId:e.data.checkoutRequestId}),j({title:"Payment Initiated",description:"Please check your phone and enter your M-PESA PIN to complete the payment."}),setTimeout(()=>{const a=e.data.checkoutRequestId;P(`/payment-success?ref=${a}&amount=${M.amount}`)},2e3)}else{if(!M.cardNumber||!M.expiryDate||!M.cvv)return j({title:"Validation Error",description:"Please fill in all card details.",variant:"destructive"}),void C(!1);await y.createPayment({clientName:M.clientName,email:M.email,amount:M.amount,policyNumber:M.policyNumber,paymentMethod:M.paymentMethod,cardNumber:M.cardNumber.slice(-4),billingPhone:M.billingPhone}),await new Promise(e=>setTimeout(e,2e3));const e=`TXN${Date.now()}`;P(`/payment-success?ref=${e}&amount=${M.amount}`)}}catch(a){j({title:"Payment Failed",description:a.message||"Failed to process payment. Please try again.",variant:"destructive"}),P("/payment-failure")}finally{C(!1)}},className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Client Information"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"clientName",children:"Client Name *"}),e.jsx(o,{id:"clientName",value:M.clientName,onChange:e=>E(a=>({...a,clientName:e.target.value})),placeholder:"Enter full name",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"amount",children:"Amount (KES) *"}),e.jsx(o,{id:"amount",type:"number",value:M.amount,onChange:e=>E(a=>({...a,amount:e.target.value})),placeholder:"15000",required:!0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Payment Method"}),e.jsxs(h,{value:M.paymentMethod,onValueChange:e=>E(a=>({...a,paymentMethod:e})),children:[e.jsxs(x,{className:"grid w-full grid-cols-2",children:[e.jsxs(u,{value:"mpesa",className:"flex items-center space-x-2",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx("span",{children:"M-PESA"})]}),e.jsxs(u,{value:"card",className:"flex items-center space-x-2",children:[e.jsx(f,{className:"h-4 w-4"}),e.jsx("span",{children:"Card"})]})]}),e.jsx(p,{value:"mpesa",className:"space-y-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"phoneNumber",children:"Phone Number *"}),e.jsx(o,{id:"phoneNumber",value:M.phoneNumber,onChange:e=>E(a=>({...a,phoneNumber:e.target.value})),placeholder:"254700123456",required:!0}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You will receive an STK push notification to complete the payment"})]})}),e.jsxs(p,{value:"card",className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cardNumber",children:"Card Number *"}),e.jsx(o,{id:"cardNumber",value:M.cardNumber,onChange:e=>E(a=>({...a,cardNumber:e.target.value})),placeholder:"1234 5678 9012 3456",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"expiryDate",children:"Expiry Date *"}),e.jsx(o,{id:"expiryDate",value:M.expiryDate,onChange:e=>E(a=>({...a,expiryDate:e.target.value})),placeholder:"MM/YY",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"cvv",children:"CVV *"}),e.jsx(o,{id:"cvv",value:M.cvv,onChange:e=>E(a=>({...a,cvv:e.target.value})),placeholder:"123",maxLength:3,required:!0})]})]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-primary",children:"Billing Details"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"email",children:"Email Address *"}),e.jsx(o,{id:"email",type:"email",value:M.email,onChange:e=>E(a=>({...a,email:e.target.value})),placeholder:"client@example.com",required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(d,{htmlFor:"billingPhone",children:"Phone Number *"}),e.jsx(o,{id:"billingPhone",value:M.billingPhone,onChange:e=>E(a=>({...a,billingPhone:e.target.value})),placeholder:"254700123456",required:!0})]})]})]}),e.jsxs("div",{className:"pt-6 border-t",children:[e.jsxs(N,{type:"submit",className:"w-full bg-accent hover:bg-accent/90 text-accent-foreground text-lg py-6",disabled:S,children:[e.jsx(g,{className:"h-5 w-5 mr-2"}),"Confirm & Pay KES ",M.amount||"15,000"]}),e.jsx("p",{className:"text-xs text-muted-foreground text-center mt-4",children:"By proceeding, you agree to our terms and conditions. Your payment is secured with 256-bit SSL encryption."})]})]})})]})})]})]})}),e.jsx(n,{})]})};export{P as default};
